\documentclass{elsarticle}

\usepackage{listings}
\usepackage{color}
\definecolor{gray}{rgb}{0.4,0.4,0.4}
\definecolor{darkblue}{rgb}{0.0,0.0,0.6}
\definecolor{cyan}{rgb}{0.0,0.6,0.6}

\lstset{
  basicstyle=\footnotesize,
  columns=fullflexible,
  showstringspaces=false,
  commentstyle=\color{gray}\upshape,
  frame=single
}

\lstdefinelanguage{XML}
{
  morestring=[b]",
  morestring=[s]{>}{<},
  morecomment=[s]{<?}{?>},
  stringstyle=\color{black},
  identifierstyle=\color{darkblue},
  keywordstyle=\color{cyan},
  morekeywords={version,type,id,material,surfaces,coeffs,boundary}% list your attributes here
}

\begin{document}

\title{The OpenMC Monte Carlo Code\tnoteref{t1}}
\tnotetext[t1]{This research was performed under appointment to the Rickover
  Fellowship Program in Nuclear Engineering sponsored by Naval Reactor Division
  of the U.S. Department of Energy.}
\author[mit]{P.K. Romano\corref{cor1}}
\ead{paul.k.romano@gmail.com}
\cortext[cor1]{Corresponding author}

\author[mit]{B. Forget}
\ead{bforget@mit.edu}

\author[mit]{K. Smith}
\ead{kord@mit.edu}

\address[mit]{Massachusetts Institute of Technology, Department of Nuclear
  Science and Engineering, 77 Massachusetts Avenue, Building 24-213, Cambridge,
  MA 02141}

\begin{abstract}
A new Monte Carlo code called OpenMC is currently under development at the
Massachusetts Institute of Technology as a tool for simulation on
high-performance computing platforms. Given that many legacy codes do not scale
well on existing and future parallel computer architectures, OpenMC has been
developed from scratch and with a focus on high performance scalable algorithms
as well as modern software design patterns. The present work describes the
methods used in the OpenMC code and demonstrates the performance and accuracy of
the code on a variety of problems.
\end{abstract}

\maketitle

\section{Introduction}

The introduction of exascale computing in the next decade will introduce a
variety of challenges both for hardware and software developers. As such,
research and development efforts are underway aimed at enabling high-fidelity,
large-scale simulations that will scale on current and future computer
achitectures. To support these studies, a new Monte Carlo code has been under
development since early 2011 at the Massachusetts Institute of Technology. The
goal in developing a new Monte Carlo code rather than using a previously
developed code is to have a code that is easily extensible for research purposes
in addition to being high performance, freely available, and written in a modern
programming language.

\section{Methods}

\subsection{Physics}

The initial work on OpenMC has focused on criticality calculations as applied to
the simluation of nuclear reactors. The solution of the eigenvalue problem
proceeds by the method of successive generations [REF] wherein a constant number
of neutron histories are tracked from birth to death. The data governing the
interaction of neutrons with various nuclei are represented using the ACE format
[REF] which is used by MCNP \cite{mcnp} and Serpent \cite{serpent}. ACE-format
data can be generated with the NJOY nuclear data processing system which
converts raw ENDF/B data into linearly-interpolable data as required by most
Monte Carlo codes. The use of a standard cross section format allows for a
direct comparison of OpenMC with other codes since the same cross section
libraries can be used.

The ACE-format contains continuous-energy cross sections for the following types
of reactions: elastic scattering, fission (or first-chance fission,
second-chance fission, etc.), inelastic scattering, (n,xn), (n,$\gamma$), and
various other absorption reactions. For those reactions with one or multiple
neutrons. For those reactions with one or more neutrons in the exit channel,
secondary angle and energy distributions may be present. In addition,
fissionable nuclides have total, prompt, and/or delayed $\nu$ as a function of
energy, neutron precursor distributions. Many nuclides also have probability
tables to be used for accurate treatment of self-shielding in the unresolved
resonance range. For bound scatterers, separate tables with $S(\alpha,\beta)$
scattering law data can be used. Cross sections are represented as tabulated
functions of energy that are linearly interpolated between sucessive values.

For neutrons at higher energies, it can be safely assumed that the motion of the
target nucleus is negligible relative to the velocity of the neutron
itself. However, in the thermal and intermediate energy ranges, the target
velocity will alter both the cross sections and the secondary energy and angle
distributions of scattered neutrons. To account for the effect on cross
sections, Doppler broadening is typically performed in the cross section
generation stage. For the angle and energy distributions, OpenMC uses a free gas
approximation \cite{freegas} wherein the velocity of the target nuclei have a
Maxwellian distribution. For thermal neutrons scattering from bound molecules
such as hydrogen or deuterium in water, graphite, beryllium, etc., the free gas
approximation will not accurately capture the scattering kinematics and
$S(\alpha,\beta)$ scattering law data must be used.

In the unresolved resonance energy range, it is not adequate to use smooth cross
sections since the experimental resolution is not fine enough to resolve all
resonances. To properly account for self-shielding in this energy range, OpenMC
uses the probability table method \cite{probtables}. For most thermal and fast
reactors, the use of probability tables will not significantly affect problem
results. However, for some problems with an appreciation flux spectrum in the
unresolved resonance range, not using probability tables will lead to incorrect
results \cite{probtables-testing}.

\subsection{Geometry}

In order to model arbitrarily complex geometric objects, OpenMC uses a
constructive solid geometry representation. In such a representation, any closed
volume can be represented as the union, intersection, and/or difference of
multiple half-spaces. Each half-space is in turn defined as the positive or
negative side of a plane or quadratic surface. This allows curved surfaces such
as spheres and cylinders to be modeled exactly with no error due to mesh
discretization. Almost all geometries of interest in particle transport can be
modeled with first and second-order surfaces with the exception of some fusion
geometries where a fourth-order torus is used.

As is typical in most Monte Carlo codes, OpenMC provides constructs that allow
the user to model a two or three-dimensional structured mesh consisting of
quadrilaterals or hexagons. These constructs are useful for modeling the core
and assembly layout in a typical light-water reactor or the hexagonal layout in
a VVER. As in MCNP and Serpent, these repeated structured are handled through
the use of universes. Transmitting, vacuum, or reflective boundary conditions
can be applied to any surface giving the user full flexibility in the treatment
of boundaries.

As OpenMC continues to mature, it is likely that more geometric constructs will
become available that give the user more flexibility and aid model generation.

\subsection{Tallies}

The tally capabilities in OpenMC are roughly based off the tally system
implemented in MC21 \cite{MC21}. The user can specify one or more filters which
identify which regions of phase space should score to a given tally as well as
the scoring function. For example, if the desired tally was the $(n,\gamma)$
reaction rate in a fuel pin, the filter would specify the cell which contains
the fuel pin and the scoring function would be the radiative capture reaction
rate. The following scoring functions are currently available: flux, total
reaction rate, scattering reaction rate, neutron production from scattering
[REF], higher scattering moments, $(n,xn)$ reaction rates, absorption reaction
rate, fission reaction rate, neutron production rate from fission, and surface
currents. The following variables can used as filters: universe, material, cell,
birth cell, surface, mesh, pre-collision energy, and post-collision energy.

With filters for pre- and post-collision energy and scoring functions for
scattering and fission production, it is possible to use OpenMC to generate
cross-sections needed for determinstics solvers such as coarse-mesh finite
diffusion.

As has been demonstrated \cite{mcnp-efficiency}, some Monte Carlo codes suffer
severe performance penalties where tallying a large number of quantites. Care
must be taken to ensure that a tally system scales well with the total number of
tally bins. In OpenMC, a mapping technique is used that allows for a fast
determination of what tally/bin combinations need to be scored to given a
particle's phase space coordinates. For each discrete filter variable, a list of
tally and bin combinations is created at the start of the simulation which would
be scored to for every possible value of the filter variable. If a particle is
in cell $n$, the mapping would tell us what tally/bin combinations specify cell
$n$ for the cell filter variable. In this manner, it is not necessary to check
the phase space variables against each tally. Note that this technique only
applies to discrete filter variables and cannot be applies to energy bins. For
energy filters, it is necessary to perform a binary search on the specified
grid.

\subsection{Input and Files}

Given that many Monte Carlo particle transport codes have been in production use
for decades, it is perhaps not surprising that their user input formats are
reminiscent of the days when decks of punch cards had to be used to perform a
simulation. Each code generally has its own arbitrary format for specifying
input and, unfortunately, these formats are generally not ``user-friendly''. To
a new user of some Monte Carlo codes, an input file may appear as merely a
conglomeration a numbers in an ASCII file with no apparent meaning. Thus, when
OpenMC was designed, it was decided that the user input should be standardized
to a format which would be easy-to-use as well as convenient for code developers
to modify and extend.

Rather than use an arbitrary text format, OpenMC uses Extensible Markup Language
(XML) [REF] for all user input files. The XML format makes it easy for a user to
visually inspect an input file and determine its contents as well as for the
code developer who must write a routine that reads the input. All the input for
a simulation is specified in multiple files that are logically grouped instead
of one long input file. In the present version of OpenMC, separate XML input
files are created for the geometry, the materials, miscellaneous settings, and
tallies. Further extensions to the code may add additional input files such as
input parameters for OpenMC accelerated by coarse-mesh finite difference
methods.

\begin{figure}
  \begin{lstlisting}[language=xml]
<?xml version="1.0"?>
<geometry>

  <!-- U-233 Sphere surrounded by U-235 -->

  <cell id="1" material="1" surfaces="-1"/>
  <cell id="2" material="2" surfaces="1 -2"/>

  <surface id="1" type="sphere" coeffs="0. 0. 0. 4.5999"/>
  <surface id="2" type="sphere" coeffs="0. 0. 0. 4.5999" boundary="vacuum"/>

</geometry>
  \end{lstlisting}
  \caption{Geometry XML file for reflected sphere of U-233}
  \label{fig:geometry-xml}
\end{figure}

\subsection{Parallelism}

Description of fission bank method.

\subsection{Code Development}

Modern fortran 2003, dictionaries/lists, git/github for version control, issue
tracking, etc., Sphinx for documentation. Support for multiple compilers at
varying levels of optimization and compilation flags.

\section{Results}

\subsection{Tally Performance}

\subsection{Parallel Scaling}

\subsection{Benchmarks}

\section{Conclusions}

\bibliography{main}
\bibliographystyle{elsarticle-num}

\end{document}
